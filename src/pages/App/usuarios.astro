---
import LayoutApp from "../../layouts/LayoutApp.astro";
import { supabase } from "../../lib/supabaseClient";

// ReactComponent
import TableUsers from "../../components/App/TableUsers";

const { cookies, redirect } = Astro;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

if (!accessToken || !refreshToken) {
  return redirect("/login");
}

const { data, error } = await supabase.auth.setSession({
  refresh_token: refreshToken.value,
  access_token: accessToken.value,
});

if (error) {
  cookies.delete("sb-access-token", {
    path: "/",
  });
  cookies.delete("sb-refresh-token", {
    path: "/",
  });

  return redirect("/login");
}
---

<LayoutApp title="panel de control">
  <div class="w-10/12 m-auto">
    <div class="flex justify-between w-full mb-8">
      <h1 class="text-2xl text-slate-800 font-semibold">
        Usuarios registrados
      </h1>
    </div>
    <!-- Tabla de publicaciones de las propiedades -->
    <div class="flex justify-center">
      <TableUsers client:load />
    </div>
  </div>
</LayoutApp>
